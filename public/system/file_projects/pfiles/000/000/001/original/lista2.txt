zad 1.

USE [183694_];
GO
CREATE SCHEMA Dabrowska
GO


zad 2.

CREATE TABLE Dlugaszewska.DIM_CUSTOMER

(   CustomerID INT NOT NULL,
	FirstName VARCHAR(50),
	LastName VARCHAR(50),
	Name VARCHAR(50),
	CountryRegionCode NVARCHAR(3) NOT NULL,
	Group_  VARCHAR(50)

)


CREATE TABLE Dlugaszewska.DIM_PRODUCT

(   ProductID INT NOT NULL,
	SubcategoryName VARCHAR(50),
	ListPrice MONEY,
	Color NVARCHAR(15),
	Name NVARCHAR(50)
)


CREATE TABLE Dlugaszewska.DIM_SALESPERSON

(   SalesPersonID INT NOT NULL,
	FirstName VARCHAR(50),
	LastName VARCHAR(50),
	Title NVARCHAR(50),
	Gender NCHAR(1),
	ContryRegionCode NVARCHAR(3),
	Group_ VARCHAR(50)
)

CREATE TABLE Dlugaszewska.FACT_SALES

(   ID INT NOT NULL,
	ProductID INT NOT NULL,
	CustomerID INT NOT NULL,
	SalesPersonID INT NOT NULL,
	OrderDate INT,
	ShipDate INT,
	OrderQty SMALLINT,
	UnitPrice MONEY,
	UnitPriceDiscount MONEY,
	LineTotal NUMERIC(17)
)

zad 3.

INSERT INTO [183694_].Dlugaszewska.DIM_CUSTOMER (CustomerID, FirstName, LastName, Name, CountryRegionCode, Group_)
SELECT Sales.Customer.CustomerID, Person.Contact.FirstName, Person.Contact.LastName, Sales.SalesTerritory.Name, Sales.SalesTerritory.CountryRegionCode, Sales.SalesTerritory.[Group] AS Group_
FROM Person.Contact 
INNER JOIN Sales.Individual ON Person.Contact.ContactID = Sales.Individual.ContactID
INNER JOIN Sales.Customer ON Sales.Individual.CustomerID = Sales.Customer.CustomerID
INNER JOIN Sales.SalesTerritory ON Sales.Customer.TerritoryID = Sales.SalesTerritory.TerritoryID ;


INSERT INTO [183694_].Dlugaszewska.DIM_PRODUCT (ProductID, SubcategoryName, ListPrice, Color, Name)
SELECT Production.Product.ProductID, Production.ProductSubcategory.Name, Production.Product.ListPrice, Production.Product.Color, Production.Product.Name
FROM Production.Product LEFT JOIN Production.ProductSubcategory ON Production.Product.ProductSubcategoryID = Production.ProductSubcategory.ProductSubcategoryID;


INSERT INTO [183694_].Dlugaszewska.DIM_SALESPERSON (SalesPersonID, FirstName, LastName, Title, Gender, CountryRegionCode, Group_)

SELECT Sales.SalesPerson.SalesPersonID, Person.Contact.FirstName, Person.Contact.LastName, HumanResources.Employee.Title, HumanResources.Employee.Gender, Sales.SalesTerritory.CountryRegionCode, Sales.SalesTerritory.[Group] AS Group_
FROM HumanResources.Employee 
LEFT JOIN Person.Contact ON HumanResources.Employee.ContactID = Person.Contact.ContactID
LEFT JOIN Sales.SalesPerson ON HumanResources.Employee.EmployeeID = Sales.SalesPerson.SalesPersonID
LEFT JOIN Sales.SalesTerritory ON Sales.SalesPerson.TerritoryID = Sales.SalesTerritory.TerritoryID
WHERE Sales.SalesPerson.SalesPersonID IS NOT NULL 


INSERT INTO [183694_].Dlugaszewska.FACT_SALES (ProductID, CustomerID, SalesPersonID, OrderDate, ShipDate, OrderQty, UnitPrice, UnitPriceDiscount, LineTotal)
SELECT Sales.SalesOrderDetail.ProductID, Sales.SalesOrderHeader.CustomerID, Sales.SalesOrderHeader.SalesPersonID, Convert(VarChar, Sales.SalesOrderHeader.OrderDate, 112) AS OrderDate, Convert(VarChar, Sales.SalesOrderHeader.ShipDate, 112) AS ShipDate, Sales.SalesOrderDetail.OrderQty, Sales.SalesOrderDetail.UnitPrice, Sales.SalesOrderDetail.UnitPriceDiscount, Sales.SalesOrderDetail.LineTotal
FROM Sales.SalesOrderHeader
LEFT JOIN Sales.SalesOrderDetail ON Sales.SalesOrderHeader.SalesOrderID = Sales.SalesOrderDetail.SalesOrderID
WHERE Sales.SalesOrderDetail.ProductID IS NOT NULL AND Sales.SalesOrderHeader.CustomerID IS NOT NULL AND Sales.SalesOrderHeader.SalesPersonID IS NOT NULL 


zad 4. 

Klucze g³ówne:

ALTER TABLE [183694_].Dlugaszewska.DIM_CUSTOMER
ADD PRIMARY KEY (CustomerID)

ALTER TABLE [183694_].Dlugaszewska.DIM_PRODUCT
ADD PRIMARY KEY (ProductID)

ALTER TABLE [183694_].Dlugaszewska.DIM_SALESPERSON
ADD PRIMARY KEY (SalesPersonID)

ALTER TABLE [183694_].Dlugaszewska.FACT_SALES
ADD PRIMARY KEY (ID)

Klucze obce razem z integralnoœci¹ referencyjn¹:


ALTER TABLE [[183694_].Dlugaszewska.FACT_SALES
ADD FOREIGN KEY (CustomerID) REFERENCES [183655_].Dabrowska.DIM_CUSTOMER(CustomerID)

ALTER TABLE [183694_].Dlugaszewska.FACT_SALES
ADD FOREIGN KEY (SalesPersonID) REFERENCES [183655_].Dabrowska.DIM_SALESPERSON(SalesPersonID)

ALTER TABLE [183694_].Dlugaszewska.FACT_SALES
ADD FOREIGN KEY (ProductID) REFERENCES [183655_].Dabrowska.DIM_PRODUCT(ProductID)


zad 5.

INSERT INTO [183694_].Dlugaszewska.DIM_CUSTOMER
VALUES (null, 'A', 'A', 'A', 'A', 'A')
--(CustomerID, FirstName, LastName, Name, CountryRegionCode, [Group])

INSERT INTO [183694_].Dlugaszewska.DIM_PRODUCT
VALUES (null, 'A', 12, 'A', 'A')
--(ProductID, ProductName, ListPrice, Color, Name)

INSERT INTO [183694_].Dlugaszewska.DIM_SALESPERSON
VALUES (null, 'A', 'A', 'A', 'A', 'A', 'A')
--(SalesPersonID, FirstName, LastName, Title, Gender, CountryRegionCode, [Group])

INSERT INTO [183694_].Dlugaszewska.FACT_SALES
VALUES (null, 12, 12, 12, 12, 12, 12, 12, 12)
--(ProductID, CustomerID, SalesPersonID, Orderdate, ShipDate, OrderQty, UnitPrice, UnitPriceDiscount, LineTotal)

zad 6.

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'FACT_SALES') 
BEGIN
DROP TABLE [183694_].Dlugaszewska.FACT_SALES
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'DIM_CUSTOMER') 
BEGIN
DROP TABLE [183694_].Dlugaszewska.DIM_CUSTOMER
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'DIM_PRODUCT') 
BEGIN
DROP TABLE [183694_].Dlugaszewska.DIM_PRODUCT
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'DIM_SALESPERSON')
BEGIN 
DROP TABLE [183694_].Dlugaszewska.DIM_SALESPERSON
END
